"use strict";function rev(n){return n-360*Math.floor(n/360)}function rev2(n){var r=rev(n);return r>=180?r-360:r}function sind(n){return Math.sin(n*DEG2RAD)}function cosd(n){return Math.cos(n*DEG2RAD)}function tand(n){return Math.tan(n*DEG2RAD)}function asind(n){return RAD2DEG*Math.asin(n)}function acosd(n){return RAD2DEG*Math.acos(n)}function atand(n){return RAD2DEG*Math.atan(n)}function atan2d(n,r){return RAD2DEG*Math.atan2(n,r)}function log10(n){return Math.LOG10E*Math.log(n)}function sqr(n){return n*n}function cbrt(n){return Math.pow(n,1/3)}function SGN(n){return 0>n?-1:1}function planet(n,r,e,a,t,s,d,o,i,c,u,l,p,y){this.name=n,this.num=r,this.N=e,this.i=a,this.w=t,this.a=s,this.e=d,this.M=o,this.radius=i,this.oblique=c,this.dayLength=u,this.yearLength=l,this.texColor=p,this.currentPlanetRotation=0,this.rgbColor=y}function planet_xyz(n,r){for(var e=r-2451543.5,a=n.w[0]+n.w[1]*e,t=n.e[0]+n.e[1]*e,s=n.a[0]+n.a[1]*e,d=n.i[0]+n.i[1]*e,o=n.N[0]+n.N[1]*e,i=rev(n.M[0]+n.M[1]*e),c=i+RAD2DEG*t*sind(i)*(1+t*cosd(i)),u=c-(c-RAD2DEG*t*sind(c)-i)/(1-t*cosd(c));Math.abs(c-u)>5e-4;)c=u,u=c-(c-RAD2DEG*t*sind(c)-i)/(1-t*cosd(c));var l=s*(cosd(u)-t),p=s*Math.sqrt(1-t*t)*sind(u),y=rev(atan2d(p,l)),A=Math.sqrt(l*l+p*p),f=A*(cosd(o)*cosd(y+a)-sind(o)*sind(y+a)*cosd(d)),h=A*(sind(o)*cosd(y+a)+cosd(o)*sind(y+a)*cosd(d)),w=A*(sind(y+a)*sind(d)),M=atan2d(h,f),v=atan2d(w,Math.sqrt(f*f+h*h+w*w));if(n.num==JUPITER){var x=rev(planets[SATURN].M[0]+planets[SATURN].M[1]*e);M+=-.332*sind(2*i-5*x-67.6)-.056*sind(2*i-2*x+21)+.042*sind(3*i-5*x+21)-.036*sind(i-2*x)+.022*cosd(i-x)+.023*sind(2*i-3*x+52)-.016*sind(i-5*x-69),f=A*cosd(M)*cosd(v),h=A*sind(M)*cosd(v)}if(n.num==SATURN){var R=rev(planets[JUPITER].M[0]+planets[JUPITER].M[1]*e);M+=.812*sind(2*R-5*i-67.6)-.229*cosd(2*R-4*i-2)+.119*sind(R-2*i-3)+.046*sind(2*R-6*i-69)+.014*sind(R-3*i+32),v+=-.02*cosd(2*R-4*i-2)+.018*sind(2*R-6*i-49),f=A*cosd(M)*cosd(v),h=A*sind(M)*cosd(v),w=A*sind(v)}if(n.num==URANUS){var R=rev(planets[JUPITER].M[0]+planets[JUPITER].M[1]*e),x=rev(planets[SATURN].M[0]+planets[SATURN].M[1]*e);M+=.04*sind(x-2*i+6)+.035*sind(x-3*i+33)-.015*sind(R-i+20),f=A*cosd(M)*cosd(v),h=A*sind(M)*cosd(v)}return new Array(f,h,w,A,M,v)}function radecr(n,r,e,a){var t=n[0]+r[0],s=n[1]+r[1],d=n[2],o=23.4393-3.563e-7*(e-2451543.5),i=t,c=s*cosd(o)-d*sind(o),u=s*sind(o)+d*cosd(o),l=rev(atan2d(c,i)),p=atan2d(u,Math.sqrt(i*i+c*c)),y=Math.sqrt(i*i+c*c+u*u);return new Array(l,p,y)}function radec2aa(n,r,e,a){var t=rev(280.46061837+360.98564736629*(e-2451545)),s=t+a.longitude,d=s-n,o=asind(sind(a.latitude)*sind(r)+cosd(a.latitude)*cosd(r)*cosd(d)),i=atan2d(sind(d),cosd(d)*sind(a.latitude)-tand(r)*cosd(a.latitude));return new Array(o,rev(i+180),d)}function separation(n,r,e,a){var t=acosd(sind(e)*sind(a)+cosd(e)*cosd(a)*cosd(n-r));.1>t&&(t=Math.sqrt(sqr(rev2(n-r)*cosd((e+a)/2))+sqr(e-a)));var s=atan2d(sind(n-r),cosd(a)*tand(e)-sind(a)*cosd(n-r));return new Array(t,rev(s))}function sunxyz(n){var r=n-2451543.5,e=282.9404+470935e-10*r,a=.016709-1.151e-9*r,t=rev(356.047+.9856002585*r),s=t+a*RAD2DEG*sind(t)*(1+a*cosd(t)),d=cosd(s)-a,o=Math.sqrt(1-a*a)*sind(s),i=atan2d(o,d),c=Math.sqrt(d*d+o*o),u=rev(i+e),l=c*cosd(u),p=c*sind(u);return new Array(l,p,0,c,u,0)}function SunAlt(n,r){var e=sunxyz(n),a=23.4393-3.563e-7*(n-2451543.5),t=e[0],s=e[1]*cosd(a),d=e[1]*sind(a),o=rev(atan2d(s,t)),i=atan2d(d,Math.sqrt(t*t+s*s)),c=radec2aa(o,i,n,r);return new Array(c[0],c[1],c[2],o,i,e[4],0,1,0,e[3],-26.74)}function MoonPos(n,r){var e=(n-2451545)/36525,a=rev(218.3164477+481267.88123421*e),t=rev(297.8501921+445267.1114034*e),s=rev(357.5291092+35999.0502909*e),d=rev(134.9633964+477198.8675055*e),o=rev(93.272095+483202.0175233*e),i=6288774*sind(d)+1274027*sind(2*t-d)+658314*sind(2*t)+213618*sind(2*d)-185116*sind(s)-114332*sind(2*o)+58793*sind(2*t-2*d)+57066*sind(2*t-s-d)+53322*sind(2*t+d)+45758*sind(2*t-s)-40923*sind(s-d)-34720*sind(t)-30383*sind(s+d)+15327*sind(2*t-2*o)-12528*sind(d+2*o)+10980*sind(d-2*o)+10675*sind(4*t-d)+10034*sind(3*d)+8548*sind(4*t-2*d)-7888*sind(2*t+s-d)-6766*sind(2*t+s)-5163*sind(t-d)+4987*sind(t+s)+4036*sind(2*t-s+d),c=5128122*sind(o)+280602*sind(d+o)+277602*sind(d-o)+173237*sind(2*t-o)+55413*sind(2*t-d+o)+46271*sind(2*t-d-o)+32573*sind(2*t+o)+17198*sind(2*d+o)+9266*sind(2*t+d-o)+8822*sind(2*d-o)+8216*sind(2*t-s-o)+4324*sind(2*t-2*d-o)+4200*sind(2*t+d+o),u=-20905355*cosd(d)-3699111*cosd(2*t-d)-2955968*cosd(2*t)-569925*cosd(2*d)+246158*cosd(2*t-2*d)-152138*cosd(2*t-s-d)-170733*cosd(2*t+d)-204586*cosd(2*t-s)-129620*cosd(s-d)+108743*cosd(t)+104755*cosd(s+d)+79661*cosd(d-2*o)+48888*cosd(s),l=rev(a+i/1e6),p=c/1e6,y=23.4393-3.563e-7*(n-2451543.5),A=rev(atan2d(sind(l)*cosd(y)-tand(p)*sind(y),cosd(l))),f=asind(sind(p)*cosd(y)+cosd(p)*sind(y)*sind(l)),h=radec2aa(A,f,n,r),w=Math.abs(180-t-6.289*sind(d)+2.1*sind(s)-1.274*sind(2*t-d)-.658*sind(2*t)-.214*sind(2*d)-.11*sind(t)),M=(1+cosd(w))/2,v=Math.round(385000.56+u/1e3),x=h[0];x-=asind(6378.14/v)*cosd(x);var R,D,T=sunxyz(n),U=T[3],E=v/149598e3,g=.23+5*log10(U*E)+.026*w+4e-9*w*w*w*w;return R=(n+4.867)/29.53059,R-=Math.floor(R),D=.5>R?29.53059*R+14.765295:29.53059*R-14.765295,D=Math.floor(D)+1,new Array(x,h[1],h[2],A,f,l,p,M,U,v,g,D)}function PlanetAlt(n,r,e){if(2==n)return SunAlt(r,e);if(n==MOON)return MoonPos(r,e);if(n==COMET)return CometAlt(r,e);var a=sunxyz(r),t=xpl.SolarSystem(xpl.planets[n],r),s=t[0]+a[0],d=t[1]+a[1],o=t[2]+a[2],i=rev(atan2d(d,s));i+=382394e-10*(r-2451545);var c=atan2d(o,Math.sqrt(s*s+d*d)),u=radecr(t,a,r,e),l=u[0],p=u[1],y=radec2aa(l,p,r,e),A=u[2],f=a[3],h=t[3],w=((h+A)*(h+A)-f*f)/(4*h*A),M=new Array(-.42,-4.4,0,-1.52,-9.4,-8.88,-7.19,-6.87),v=acosd((h*h+A*A-f*f)/(2*h*A)),x=M[n]+5*log10(h*A);switch(n){case MERCURY:x+=v*(.038+v*(-273e-6+2e-6*v));break;case VENUS:x+=v*(9e-4+v*(239e-6-6.5e-7*v));break;case MARS:x+=.016*v;break;case JUPITER:x+=.005*v;break;case SATURN:var R=(r-2451545)/36525,D=28.075216-.012998*R+4e-6*R*R,T=169.50847+1.394681*R+412e-6*R*R,U=asind(sind(D)*cosd(c)*sind(i-T)-cosd(D)*sind(c)),E=t[4],g=t[5],S=atan2d(sind(D)*sind(g)+cosd(D)*cosd(g)*sind(E-T),cosd(g)*cosd(E-T)),m=atan2d(sind(D)*sind(c)+cosd(D)*cosd(c)*sind(i-T),cosd(c)*cosd(i-T)),b=Math.abs(S-m);x+=.044*b-2.6*sind(Math.abs(U))+1.25*sind(U)*sind(U)}return new Array(y[0],y[1],y[2],l,p,i,c,w,h,A,x)}function jday(n,r,e,a,t,s){return"undefined"==typeof n?n=0:{},"undefined"==typeof r?r=0:{},"undefined"==typeof e?e=0:{},"undefined"==typeof a?a=0:{},"undefined"==typeof t?t=0:{},"undefined"==typeof s?s=0:{},computeTheForm(n,r,e,a,t,s)}function computeTheForm(n,r,e,a,t,s){var d=e,o=r,i=n;3>o&&(i--,o+=12);var c=Math.floor(i/100),u=Math.floor(c/4),l=2-c+u,p=Math.floor(365.25*(i+4716)),y=Math.floor(30.6001*(o+1)),A=l+d+p+y-1524.5,f=A+((s/60+t)/60+a)/24;return f}function dateFromJday(n){var r,e,a,t,s,d=Math.floor(n),o=n-d,i=2299161;if(d>=i){var c=Math.floor((d-1867216-.25)/36524.25);r=d+1+c-Math.floor(.25*c)}else r=d;var u=o+.5;u>=1&&(u-=1,++r),e=r+1524,a=Math.floor(6680+(e-2439870-122.1)/365.25),t=Math.floor(365.25*a),s=Math.floor((e-t)/30.6001);var l=Math.floor(e-t-Math.floor(30.6001*s)),p=Math.floor(s-1);p>12&&(p-=12);var y=Math.floor(a-4715);p>2&&--y,0>=y&&--y;var A=Math.floor(24*u),f=Math.floor(60*(24*u-A)),h=60*(60*(24*u-A)-f),w=Math.floor(h);return h-=w,h>.5&&++w,{year:y,month:p,day:l,hour:A,minute:f,sec:w}}var xpl={},DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;xpl.DEG2RAD=DEG2RAD,xpl.RAD2DEG=RAD2DEG,xpl.translatePositions=function(n,r){var e=[];if(null!==n&&r.length==n.length)for(var a=0;a<n.length;a++)e.push(r[a]+n[a]);return e};var MERCURY=0,VENUS=1,EARTH=2,MARS=3,JUPITER=4,SATURN=5,URANUS=6,NEPTUNE=7,SUN=9,MOON=10,COMET=15,USER=20,ndiam=[6.72,16.68,1,9.36,196.88,165.46,70.04,67,1,1919.3,7169e5];planet.prototype.rotationAt=function(n){var r=n%(this.dayLength/23.9344)*2*Math.PI+.04363323127;return r},xpl.sol={radius:696300,dayLength:587.28,texColor:16777028,rgbColor:{r:255,g:255,b:68}},xpl.mercury=new planet("Mercury",0,new Array(48.3313,324587e-10),new Array(7.0047,5e-8),new Array(29.1241,101444e-10),new Array(.387098,0),new Array(.205635,5.59e-10),new Array(168.6562,4.0923344368),1219.75,.01,4222.6,87.969,16777215,{r:255,g:255,b:255}),xpl.venus=new planet("Venus",1,new Array(76.6799,24659e-9),new Array(3.3946,2.75e-8),new Array(54.891,138374e-10),new Array(.72333,0),new Array(.006773,-1.302e-9),new Array(48.0052,1.6021302244),6052,177.4,2802,224.701,16750899,{r:255,g:153,b:51});var eObl=xpl.curEarthOblique(xpl.now);xpl.earth=new planet("Earth",2,new Array(0,0),new Array(0,0),new Array(282.9404,470935e-10),new Array(-1,0),new Array(.016709,-1.151e-9),new Array(356.047,.9856002585),6378,eObl,23.9344,365.256,65433,{r:0,g:255,b:153}),xpl.mars=new planet("Mars",3,new Array(49.5574,211081e-10),new Array(1.8497,-1.78e-8),new Array(286.5016,292961e-10),new Array(1.523688,0),new Array(.093405,2.516e-9),new Array(18.6021,.5240207766),3396,25.2,24.7,686.98,16711680,{r:255,g:0,b:0}),xpl.jupiter=new planet("Jupiter",4,new Array(100.4542,276854e-10),new Array(1.303,-1.557e-7),new Array(273.8777,164505e-10),new Array(5.20256,0),new Array(.048498,4.469e-9),new Array(19.895,.0830853001),71492,3.1,9.9,4332.589,16731528,{r:255,g:77,b:136}),xpl.saturn=new planet("Saturn",5,new Array(113.6634,23898e-9),new Array(2.4886,-1.081e-7),new Array(339.3939,297661e-10),new Array(9.55475,0),new Array(.055546,-9.499e-9),new Array(316.967,.0334442282),60268,26.7,10.7,10759.22,10551040,{r:160,g:255,b:0}),xpl.uranus=new planet("Uranus",6,new Array(74.0005,13978e-9),new Array(.7733,1.9e-8),new Array(96.6612,30565e-9),new Array(19.18171,-1.55e-8),new Array(.047318,7.45e-9),new Array(142.5905,.011725806),25559,97.8,17.2,30685.4,22015,{r:0,g:85,b:255}),xpl.neptune=new planet("Neptune",7,new Array(131.7806,30173e-9),new Array(1.77,-2.55e-7),new Array(272.8461,-6027e-9),new Array(30.05826,3.313e-8),new Array(.008606,2.15e-9),new Array(260.2471,.005995147),24764,28.3,16.1,60189,7536793,{r:115,g:0,b:153});var planets=[xpl.mercury,xpl.venus,xpl.earth,xpl.mars,xpl.jupiter,xpl.saturn,xpl.uranus,xpl.neptune];xpl.planets=planets;for(var p in planets)planets[p].rotationAt(xpl.now);xpl.SolarSystem=function(n,r){return planet_xyz(n,r)},xpl.radecr=function(n,r,e,a){return radecr(n,r,e,a)},xpl.radec2aa=function(n,r,e,a){return radec2aa(n,r,e,a)},xpl.MoonPos=function(n,r){return MoonPos(n,r)},xpl.PlanetAlt=function(n,r,e){return PlanetAlt(n,r,e)};var scl=1;xpl.setScale=function(n){scl=n},xpl.getScale=function(){return scl},xpl.scaleVec3=function(n){var r=n.x*scl,e=n.y*scl,a=n.z*scl;return{x:r,y:e,z:a}},xpl.scaleArray=function(n){var r=[];for(var e in n)r.push(n[e]*scl);return r},xpl.scalef=function(n){return n*scl},xpl.kmtoau=function(n){return 6.6846e-9*n},xpl.daysToSeconds=function(n){return n/1157407e-11},xpl.hoursToSeconds=function(n){return 3600*n},xpl.minutesToSeconds=function(n){return 60*n},xpl.secondsToDays=function(n){return 1157407e-11*n},xpl.secondsToHours=function(n){return n/3600},xpl.secondsToMinutes=function(n){return n/60},xpl.jday=function(n,r,e,a,t,s){return jday(n,r,e,a,t,s)},xpl.dateFromJday=function(n){return dateFromJday(n)};var now=new Date;xpl.now=jday(now.getUTCFullYear(),now.getUTCMonth()+1,now.getUTCDate(),now.getUTCHours(),now.getUTCMinutes(),now.getUTCSeconds()),xpl.updateTime=function(n){var r="undefined"!=typeof n?r:0,e=new Date;xpl.now=jday(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()+r)};